<!-- Schedule rules section, collapsed by default -->
<p class="text-center mt-3">
    <button id="{{instance}}-open-rules" class="btn btn-sm btn-primary open-rules" type="button" data-bs-toggle="collapse" data-bs-target="#{{instance}}-schedule-rules" aria-expanded="false" aria-controls="{{instance}}-schedule-rules" onclick="open_rules(this)">
        Schedule rules
    </button>
</p>
<div class="collapse text-center" id="{{instance}}-schedule-rules">
    {# Hide table if no rules exist (would just see headings, confusing) #}
    <table id="{{instance}}-rules" class="table table-borderless {% if params.schedule.items|length == 0 %} d-none {% endif %}">
        <tr>
            <th class="w-50">Time</th>
            <th class="w-50">Rule</th>
        </tr>

        {% if params.schedule.items|length > 0 %}
            {% for time, rule in params.schedule.items %}
                <tr id="{{instance}}-row-{{forloop.counter}}">
                    {# Add time field #}
                    <td><span class="form-control schedule-rule time" id="{{instance}}-rule{{forloop.counter}}-time" data-original="{{time}}" data-type="{{params.type}}" onclick="edit_existing_rule(this);">{{time}}</span></td>

                    {# Add rule field #}
                    {% if params.prompt == "api_target" %}
                        <td><span class="form-control schedule-rule" id="{{instance}}-rule{{forloop.counter}}-button" data-original="{{rule}}" data-type="{{params.type}}" onclick="edit_existing_rule(this);">click to view</span>
                        <input type="text" class="form-control" id="{{instance}}-rule{{forloop.counter}}" data-original="{{rule}}" data-type="{{params.type}}" style="display:none;"></td>
                    {% else %}
                        <td><span class="form-control schedule-rule" id="{{instance}}-rule{{forloop.counter}}" data-original="{{rule}}" data-type="{{params.type}}"  onclick="edit_existing_rule(this);">{{rule}}</span></td>
                    {% endif %}

                    {# Add edit/delete button #}
                    <td class="min"><button type="button" class="btn btn-sm btn-primary mt-1" id="{{instance}}-edit{{forloop.counter}}" data-type="{{params.type}}" onclick="edit_existing_rule(this);"><i class="bi-pencil"></i></button></td>
                </tr>
            {% endfor %}
        {% endif %}
    </table>

    {# Add new rule button #}
    <div class="text-center mx-3 mb-3">
        <button type="button" class="btn btn-secondary btn-sm add" id="{{instance}}-add-rule" data-type="{{params.type}}" onclick="add_new_rule(this)"><i class="bi-plus-lg"></i></button>
    </div>
</div>
