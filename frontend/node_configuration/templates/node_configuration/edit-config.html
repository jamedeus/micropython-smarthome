{% load static %}
{% load pwa %}
{% load is_device %}
{% load is_sensor %}
{% load only_digits %}
{% load get_metadata %}

<!DOCTYPE html>
<html lang="en">
<head>
    <title>{{ TITLE }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    {% progressive_web_app_meta %}
    <link rel="stylesheet" href="{% static 'bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'bootstrap-icons.css' %}">
    <link rel="stylesheet" href="{% static 'node_configuration/style.css' %}">
    <link rel="stylesheet" href="{% static 'api/sliders.css' %}">
    <script src="{% static 'bootstrap.min.js' %}"></script>
    <script src="{% static 'jquery.min.js' %}"></script>
    <script src="{% static 'rangeslider.min.js' %}"></script>
    <script src="{% static 'smoothscroll.min.js' %}"></script>
    <script src="{% static 'react.production.min.js' %}"></script>
    <script src="{% static 'react-dom.production.min.js' %}"></script>
    <style>
        /* Force equal width for schedule rule fields */
        td {
            width: 50%;
        }

        /* Delete card animation */
        :root {
            --animation-height: 25rem;
        }

        @keyframes slide-up {
            0% {
                bottom: 0rem;
            }
            100% {
                bottom: var(--animation-height);
            }
        }

        .slide-up {
            animation-name: slide-up;
            animation-duration: 0.8s;
            animation-timing-function: ease;
            animation-fill-mode: forwards;
        }

        @keyframes fade-out {
            0% {
                opacity: 100%;
            }
            100% {
                opacity: 0%;
            }
        }

        .fade-out {
            animation-name: fade-out;
            animation-duration: 0.4s;
            animation-timing-function: ease;
            animation-fill-mode: forwards;
        }

        .fade-in {
            animation-name: fade-out;
            animation-direction: reverse;
            animation-duration: 0.4s;
            animation-timing-function: ease;
            animation-fill-mode: forwards;
        }
    </style>
</head>

<body>
    <script>
        // Check if user is in dark mode, change theme (runs once on page load)
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add("dark");
            console.log("Dark mode");
        } else {
            document.body.classList.add("light");
        };
    </script>

    <!-- TODO django template inserts config file to dataset attribute here -->
    <div id="root" class="container d-flex flex-column vh-100" data-config="{{config}}"></div>
    {{ metadata|json_script:"instance_metadata" }}
    {{ config|json_script:"config" }}
    <script>
        // TODO django template inserts metadata context here
        const metadata = JSON.parse(document.getElementById("instance_metadata").textContent);

        // Listen for system theme changes, switch to dark/light mode to reflect (responsive)
        window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
            if (e.matches) { // Returns True for dark mode, False otherwise
                document.body.classList.add("dark");
                document.body.classList.remove("light");

                // Modal close buttons
                document.querySelectorAll('.btn-close').forEach(button => button.classList.add("btn-close-white"));
            } else {
                document.body.classList.remove("dark");
                document.body.classList.add("light");

                // Modal close buttons
                document.querySelectorAll('.btn-close').forEach(button => button.classList.remove("btn-close-white"));
            };
        });

        // Set modal close button color (runs once on load)
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.querySelectorAll('.btn-close').forEach(button => button.classList.add("btn-close-white"));
        };
    </script>
    <script src="{% static 'node_configuration/edit_config.js' %}"></script>
</body>
</html>
